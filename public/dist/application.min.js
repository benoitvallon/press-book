"use strict";var ApplicationConfiguration=function(){var applicationModuleName="press-book",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","angularFileUpload"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("articles"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("images"),ApplicationConfiguration.registerModule("pins"),ApplicationConfiguration.registerModule("pressbooks"),ApplicationConfiguration.registerModule("users"),angular.module("articles").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Articles","articles","dropdown","/articles(/create)?"),Menus.addSubMenuItem("topbar","articles","List Articles","articles"),Menus.addSubMenuItem("topbar","articles","New Article","articles/create")}]),angular.module("articles").config(["$stateProvider",function($stateProvider){$stateProvider.state("listArticles",{url:"/articles",templateUrl:"modules/articles/views/list-articles.client.view.html"}).state("createArticle",{url:"/articles/create",templateUrl:"modules/articles/views/create-article.client.view.html"}).state("viewArticle",{url:"/articles/:articleId",templateUrl:"modules/articles/views/view-article.client.view.html"}).state("editArticle",{url:"/articles/:articleId/edit",templateUrl:"modules/articles/views/edit-article.client.view.html"})}]),angular.module("articles").controller("ArticlesController",["$scope","$stateParams","$location","Authentication","Articles",function($scope,$stateParams,$location,Authentication,Articles){$scope.authentication=Authentication,$scope.create=function(){var article=new Articles({title:this.title,content:this.content});article.$save(function(response){$location.path("articles/"+response._id),$scope.title="",$scope.content=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(article){if(article){article.$remove();for(var i in $scope.articles)$scope.articles[i]===article&&$scope.articles.splice(i,1)}else $scope.article.$remove(function(){$location.path("articles")})},$scope.update=function(){var article=$scope.article;article.$update(function(){$location.path("articles/"+article._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.articles=Articles.query()},$scope.findOne=function(){$scope.article=Articles.get({articleId:$stateParams.articleId})}}]),angular.module("articles").factory("Articles",["$resource",function($resource){return $resource("articles/:articleId",{articleId:"@_id"},{update:{method:"PUT"}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function($scope,Authentication,Menus){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),angular.module("images").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Images","images","dropdown","/images(/create)?"),Menus.addSubMenuItem("topbar","images","List Images","images"),Menus.addSubMenuItem("topbar","images","Upload Images","images/create")}]),angular.module("images").config(["$stateProvider",function($stateProvider){$stateProvider.state("listImages",{url:"/images",templateUrl:"modules/images/views/list-images.client.view.html"}).state("createImage",{url:"/images/create",templateUrl:"modules/images/views/create-image.client.view.html"}).state("viewImage",{url:"/images/:imageId",templateUrl:"modules/images/views/view-image.client.view.html"})}]),angular.module("images").controller("ImagesController",["$scope","$stateParams","$location","Images","$http","FileUploader","Authentication",function($scope,$stateParams,$location,Images,$http,FileUploader,Authentication){$scope.authentication=Authentication;var uploader=$scope.uploader=new FileUploader({url:"/images"});uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),uploader.onWhenAddingFileFailed=function(item,filter,options){},uploader.onAfterAddingFile=function(fileItem){},uploader.onAfterAddingAll=function(addedFileItems){},uploader.onBeforeUploadItem=function(item){},uploader.onProgressItem=function(fileItem,progress){},uploader.onProgressAll=function(progress){},uploader.onSuccessItem=function(fileItem,response,status,headers){},uploader.onErrorItem=function(fileItem,response,status,headers){console.info("onErrorItem",fileItem,response,status,headers)},uploader.onCancelItem=function(fileItem,response,status,headers){},uploader.onCompleteItem=function(fileItem,response,status,headers){},uploader.onCompleteAll=function(){$location.path("images")},$scope.remove=function(image){if(image){image.$remove();for(var i in $scope.images)$scope.images[i]===image&&$scope.images.splice(i,1)}else $scope.image.$remove(function(){$location.path("images")})},$scope.find=function(){$scope.images=Images.query()},$scope.findOne=function(){$scope.image=Images.get({imageId:$stateParams.imageId})},$scope.addToPressbook=function(image){image.isInPressbook=!image.isInPressbook,image.$update(function(){},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.convertSize=function(image){return Math.round(image.size/1024/1024*100)/100+"Mb"}}]),angular.module("images").directive("ngThumb",["$window",function($window){var helper={support:!(!$window.FileReader||!$window.CanvasRenderingContext2D),isFile:function(item){return angular.isObject(item)&&item instanceof $window.File},isImage:function(file){var type="|"+file.type.slice(file.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}};return{restrict:"A",template:"<canvas/>",link:function(scope,element,attributes){function onLoadFile(event){function onLoadImage(){var width=params.width||img.width/img.height*params.height,height=params.height||img.height/img.width*params.width;canvas.attr({width:width,height:height}),canvas[0].getContext("2d").drawImage(img,0,0,width,height)}var img=new Image;img.onload=onLoadImage,img.src=event.target.result}if(helper.support){var params=scope.$eval(attributes.ngThumb);if(helper.isFile(params.file)&&helper.isImage(params.file)){var canvas=element.find("canvas"),reader=new FileReader;reader.onload=onLoadFile,reader.readAsDataURL(params.file)}}}}}]),angular.module("images").factory("Images",["$resource",function($resource){return $resource("images/:imageId",{imageId:"@_id"},{update:{method:"PUT"}})}]),angular.module("pins").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Pins","pins","dropdown","/pins(/create)?"),Menus.addSubMenuItem("topbar","pins","List Pins","pins"),Menus.addSubMenuItem("topbar","pins","Extract Pins","pins/create")}]),angular.module("pins").config(["$stateProvider",function($stateProvider){$stateProvider.state("listPins",{url:"/pins",templateUrl:"modules/pins/views/list-pins.client.view.html"}).state("createPin",{url:"/pins/create",templateUrl:"modules/pins/views/create-pin.client.view.html"}).state("viewPin",{url:"/pins/:pinId",templateUrl:"modules/pins/views/view-pin.client.view.html"})}]),angular.module("pins").controller("PinsController",["$scope","$stateParams","$location","Pins","Authentication",function($scope,$stateParams,$location,Pins,Authentication){$scope.create=function(){var pin=new Pins({accountName:this.accountName,boardName:this.boardName});pin.$save(function(response){$location.path("pins"),$scope.accountName="",$scope.boardName=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(pin){if(pin){pin.$remove();for(var i in $scope.pins)$scope.pins[i]===pin&&$scope.pins.splice(i,1)}else $scope.pin.$remove(function(){$location.path("pins")})},$scope.update=function(){var pin=$scope.pin;pin.$update(function(){$location.path("pins/"+pin._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.pins=Pins.query()},$scope.findOne=function(){$scope.pin=Pins.get({pinId:$stateParams.pinId})},$scope.getBigImageLink=function(pin){return pin.imageLink?pin.imageLink.replace("237x","736x"):void 0},$scope.addToPressbook=function(pin){pin.isInPressbook=!pin.isInPressbook,pin.$update(function(){},function(errorResponse){$scope.error=errorResponse.data.message})}}]),angular.module("pins").factory("Pins",["$resource",function($resource){return $resource("pins/:pinId",{pinId:"@_id"},{update:{method:"PUT"}})}]),angular.module("pressbooks").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Pressbooks","pressbooks","dropdown","/pressbooks(/create)?"),Menus.addSubMenuItem("topbar","pressbooks","List Pressbooks","pressbooks"),Menus.addSubMenuItem("topbar","pressbooks","Generate Pressbooks","pressbooks/generate")}]),angular.module("pressbooks").config(["$stateProvider",function($stateProvider){$stateProvider.state("listPressbooks",{url:"/pressbooks",templateUrl:"modules/pressbooks/views/list-pressbooks.client.view.html"}).state("generatePressbook",{url:"/pressbooks/generate",templateUrl:"modules/pressbooks/views/generate-pressbook.client.view.html"}).state("viewPressbook",{url:"/pressbooks/:pressbookId",templateUrl:"modules/pressbooks/views/view-pressbook.client.view.html"})}]),angular.module("pressbooks").controller("PressbooksController",["$scope","$stateParams","$location","Pressbooks","$http","Authentication",function($scope,$stateParams,$location,Pressbooks,$http,Authentication){function suggestPlaceholder1(term){for(var q=term.toLowerCase().trim(),results=[],i=0;i<$scope.acPlaceholder1Values.length&&results.length<10;i++){var state=$scope.acPlaceholder1Values[i];0===state.toLowerCase().indexOf(q)&&results.push({label:state,value:state})}return results}function suggestPlaceholder2(term){for(var q=term.toLowerCase().trim(),results=[],i=0;i<$scope.acPlaceholder2Values.length&&results.length<10;i++){var state=$scope.acPlaceholder2Values[i];0===state.toLowerCase().indexOf(q)&&results.push({label:state,value:state})}return results}function suggestPlaceholder3(term){for(var q=term.toLowerCase().trim(),results=[],i=0;i<$scope.acPlaceholder3Values.length&&results.length<10;i++){var state=$scope.acPlaceholder3Values[i];0===state.toLowerCase().indexOf(q)&&results.push({label:state,value:state})}return results}$scope.authentication=Authentication,$scope.pressbookTempo={},$scope.placeholder1={},$scope.placeholder2={},$scope.placeholder3={},$scope.placeholder4={},$scope.remove=function(pressbook){if(pressbook){pressbook.$remove();for(var i in $scope.pressbooks)$scope.pressbooks[i]===pressbook&&$scope.pressbooks.splice(i,1)}else $scope.pressbook.$remove(function(){$location.path("pressbooks")})},$scope.update=function(pressbook){$scope.placeholder1.value&&(pressbook.placeholder1=$scope.placeholder1.value,$scope.placeholder1.value=""),$scope.placeholder2.value&&(pressbook.placeholder2=$scope.placeholder2.value,$scope.placeholder2.value=""),$scope.placeholder3.value&&(pressbook.placeholder3=$scope.placeholder3.value,$scope.placeholder3.value=""),$scope.placeholder4.value&&(pressbook.placeholder4=$scope.placeholder4.value,$scope.placeholder4.value=""),updateAcPlaceholderValues(pressbook),pressbook.$update(function(err){pressbook.edit=!1},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.pressbooks=Pressbooks.query(function(data){$scope.pressbooks.forEach(function(pressbook){updateAcPlaceholderValues(pressbook)})})};var updateAcPlaceholderValues=function(pressbook){pressbook.placeholder1&&!~$scope.acPlaceholder1Values.indexOf(pressbook.placeholder1)&&$scope.acPlaceholder1Values.push(pressbook.placeholder1),pressbook.placeholder2&&!~$scope.acPlaceholder2Values.indexOf(pressbook.placeholder2)&&$scope.acPlaceholder2Values.push(pressbook.placeholder2),pressbook.placeholder3&&!~$scope.acPlaceholder3Values.indexOf(pressbook.placeholder3)&&$scope.acPlaceholder3Values.push(pressbook.placeholder3)};$scope.findOne=function(){$scope.pressbook=Pressbooks.get({pressbookId:$stateParams.pressbookId})},$scope.getImageLink=function(pressbook){return pressbook&&pressbook.image?"/uploads/"+pressbook.image.filename:pressbook&&pressbook.pin?pressbook.pin.imageLink.replace("237x","736x"):void 0},$scope.getType=function(pressbook){return pressbook.image?"Image":pressbook.pin?"Pin":void 0},$scope.edit=function(pressbook){pressbook.edit=!pressbook.edit,pressbook.edit?($scope.placeholder1.value=pressbook.placeholder1,$scope.placeholder2.value=pressbook.placeholder2,$scope.placeholder3.value=pressbook.placeholder3,$scope.placeholder4.value=pressbook.placeholder4):($scope.placeholder1.value="",$scope.placeholder2.value="",$scope.placeholder3.value="",$scope.placeholder4.value="")},$scope.updateText=function(){$scope.textTemplateEncoded=encodeURIComponent($scope.textTemplate)},$scope.acPlaceholder1Values=[],$scope.acPlaceholder2Values=[],$scope.acPlaceholder3Values=[],$scope.acPlaceholder1={suggest:suggestPlaceholder1},$scope.acPlaceholder2={suggest:suggestPlaceholder2},$scope.acPlaceholder3={suggest:suggestPlaceholder3}}]),angular.module("pressbooks").directive("massAutocomplete",["$timeout","$window","$document","$q",function($timeout,$window,$document,$q){return{restrict:"A",scope:{options:"&massAutocomplete"},transclude:!0,template:'<span ng-transclude></span><div class="ac-container" ng-show="show_autocomplete && results.length > 0"><ul class="ac-menu"><li ng-repeat="result in results" ng-if="$index > 0" class="ac-menu-item" ng-class="$index == selected_index ? \'ac-state-focus\': \'\'"><span href ng-click="apply_selection($index)" ng-bind-html="result.label"></span></li></ul></div>',link:function(scope,element){scope.container=angular.element(element[0].getElementsByClassName("ac-container")[0])},controller:["$scope",function($scope){function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}function _position_autocomplete(){var rect=current_element[0].getBoundingClientRect(),scrollTop=$document[0].body.scrollTop||$document[0].documentElement.scrollTop||$window.pageYOffset,scrollLeft=$document[0].body.scrollLeft||$document[0].documentElement.scrollLeft||$window.pageXOffset,container=$scope.container[0];container.style.top=rect.top+rect.height+scrollTop+"px",container.style.left=rect.left+scrollLeft+"px",container.style.width=rect.width+"px"}function _attach(ngmodel,target_element,options){current_element!==target_element&&(current_element&&that.detach(),target_element[0]===$document[0].activeElement&&(options.on_attach&&options.on_attach(),current_element=target_element,current_model=ngmodel,current_options=options,previous_value=ngmodel.$viewValue,$scope.results=[],$scope.selected_index=-1,bind_element(),value_watch=$scope.$watch(function(){return ngmodel.$modelValue},function(nv,ov){nv!==last_selected_value&&(_position_autocomplete(),suggest(nv,current_element))})))}function _suggest(term,target_element){$scope.selected_index=0,$scope.waiting_for_suggestion=!0,"string"==typeof term&&term.length>0?$q.when(current_options.suggest(term),function(suggestions){current_element&&current_element===target_element&&(suggestions&&suggestions.length>0?($scope.results=[{value:term,label:""}].concat(suggestions),$scope.show_autocomplete=!0,current_options.auto_select_first&&set_selection(1)):$scope.results=[])},function(error){$scope.show_autocomplete=!1,current_options.on_error&&current_options.on_error(error)})["finally"](function(){$scope.waiting_for_suggestion=!1}):($scope.waiting_for_suggestion=!1,$scope.show_autocomplete=!1,$scope.$apply())}function update_model_value(value){current_model.$modelValue!==value&&(current_model.$setViewValue(value),current_model.$render())}function set_selection(i){var selected=$scope.results[i];return current_element.val(selected.value),$scope.selected_index=i,selected}function bind_element(){angular.element($window).bind(EVENTS.RESIZE,position_autocomplete),current_element.bind(EVENTS.BLUR,function(){$timeout(function(){current_element&&current_element[0]===$document[0].activeElement||that.detach()},user_options.debounce_blur)}),current_element.bind(EVENTS.KEYDOWN,function(e){if(!e.shiftKey)switch(e.keyCode){case KEYS.ESC:$scope.show_autocomplete?($scope.show_autocomplete=!1,$scope.$apply()):current_element.val(previous_value);break;case KEYS.ENTER:$scope.show_autocomplete&&$scope.selected_index>0&&!$scope.waiting_for_suggestion&&($scope.apply_selection($scope.selected_index),e.stopPropagation(),e.preventDefault()),$scope.show_autocomplete=!1,$scope.$apply();break;case KEYS.TAB:if(!$scope.show_autocomplete)break;e.preventDefault();case KEYS.DOWN:$scope.results.length>0&&($scope.show_autocomplete?set_selection($scope.selected_index+1>$scope.results.length-1?0:$scope.selected_index+1):($scope.show_autocomplete=!0,$scope.selected_index=0),$scope.$apply());break;case KEYS.UP:$scope.show_autocomplete&&(e.preventDefault(),set_selection($scope.selected_index-1>=0?$scope.selected_index-1:$scope.results.length-1),$scope.$apply())}})}var current_element,current_model,current_options,previous_value,value_watch,last_selected_value,that=this,KEYS={TAB:9,ESC:27,ENTER:13,UP:38,DOWN:40},EVENTS={KEYDOWN:"keydown",RESIZE:"resize",BLUR:"blur"},_user_options=$scope.options()||{},user_options={debounce_position:_user_options.debounce_position||150,debounce_attach:_user_options.debounce_attach||300,debounce_suggest:_user_options.debounce_suggest||200,debounce_blur:_user_options.debounce_blur||150};$scope.show_autocomplete=!1;var position_autocomplete=debounce(_position_autocomplete,user_options.debounce_position);that.attach=debounce(_attach,user_options.debounce_attach);var suggest=debounce(_suggest,user_options.debounce_suggest);that.detach=function(){if(current_element){var value=current_element.val();update_model_value(value),current_options.on_detach&&current_options.on_detach(value),current_element.unbind(EVENTS.KEYDOWN),current_element.unbind(EVENTS.BLUR)}$scope.show_autocomplete=!1,angular.element($window).unbind(EVENTS.RESIZE),value_watch&&value_watch(),$scope.selected_index=$scope.results=void 0,current_model=current_element=previous_value=void 0},$scope.apply_selection=function(i){if(current_element[0].focus(),!(!$scope.show_autocomplete||i>$scope.results.length||0>i)){var selected=set_selection(i);last_selected_value=selected.value,update_model_value(selected.value),$scope.show_autocomplete=!1,current_options.on_select&&current_options.on_select(selected)}},$scope.$on("$destroy",function(){that.detach(),$scope.container.remove()})}]}}]).directive("massAutocompleteItem",function(){return{restrict:"A",require:["^massAutocomplete","ngModel"],scope:{massAutocompleteItem:"&"},link:function(scope,element,attrs,required){attrs.$set("autocomplete","off"),element.bind("focus",function(){var options=scope.massAutocompleteItem();if(!options)throw"Invalid options";required[0].attach(required[1],element,options)})}}}),angular.module("pressbooks").factory("Pressbooks",["$resource",function($resource){return $resource("pressbooks/:pressbookId",{pressbookId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);